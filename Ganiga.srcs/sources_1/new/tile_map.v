`timescale 1ns / 1ps

module tile_map(
    input  wire [9:0] x,
    input  wire [9:0] y,
    output reg  [3:0] r, g, b,
    output wire       is_wall
    );

    // --- 1. ????????????????? (Scale 16x16 Pixel) ---
    // ??????? 32 (??? 5 bit) -> ?????????????? 16 (??? 4 bit ???????)
    wire [5:0] col = x[9:4]; // ????????? 0 ??? 39 (40 ????)
    wire [5:0] row = y[9:4]; // ????????? 0 ??? 29 (30 ????)
    
    // --- 2. ????? Address ???? ---
    // ????: (??? * ?????????) + ???????
    // ???????????????? 40
    wire [10:0] addr = (row * 40) + col; 

    // --- 3. ???????? Memory ---
    // 40 x 30 = 1200 ????
    reg [3:0] map_data [0:1199];

    initial begin
        $readmemh("map.mem", map_data); 
    end

    reg [3:0] tile_id;

    always @(*) begin
        // Safety: ????????????????????????
        if (row < 30 && col < 40)
            tile_id = map_data[addr];
        else
            tile_id = 4'h0;

        // --- 4. ??????? (Palette) ????????? ---
        case (tile_id)
            // 0: ???? (????????) -> ?????????
            4'h0: begin r = 4'h2; g = 4'h7; b = 4'h2; end 
            
            // 1: ??????/??????? (?????) -> ?????????
            4'h1: begin r = 4'h1; g = 4'h4; b = 4'h1; end 
            
            // 2: ??? (Road) -> ?????
            4'h2: begin r = 4'h6; g = 4'h6; b = 4'h7; end 
            
            // 3: ?????? (Dirt/Shoulder) -> ????????
            4'h3: begin r = 4'h8; g = 4'h5; b = 4'h2; end 
            
            // 4: ??????? (Line) -> ?????/??????????
            4'h4: begin r = 4'hD; g = 4'hD; b = 4'hD; end 

            default: begin r = 0; g = 0; b = 0; end
        endcase
    end
    
    // ???????????????????????????????/???? (??????????? ??????=1)
    assign is_wall = (tile_id == 4'h1);

endmodule